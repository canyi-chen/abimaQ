% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/abimaQ.R
\name{extract_margin_dispersion}
\alias{extract_margin_dispersion}
\title{Extract/Estimate Dispersion (and NB Size) for a GLM Margin}
\usage{
extract_margin_dispersion(y, X, eta, family, fit_nb_size = NULL)
}
\arguments{
\item{y}{Numeric response vector (\code{n}).}

\item{X}{Numeric design matrix (\code{n × p}); should include intercept column if modeled.}

\item{eta}{Numeric linear predictor \code{X*beta} (length \code{n}).}

\item{family}{A \code{\link[stats]{family}} object used for the margin.}

\item{fit_nb_size}{Optional numeric; if provided for Negative Binomial,
it will be returned in \code{extra$size}.}
}
\value{
A list with components:
\describe{
\item{\code{fam}}{Character family name.}
\item{\code{link}}{Character link name.}
\item{\code{disp}}{Estimated dispersion \eqn{\phi}.}
\item{\code{extra}}{List with \code{size} when NB; otherwise empty.}
}
}
\description{
Estimates the dispersion parameter \eqn{\phi} for a fitted margin from
\code{(y, X, eta, family)}. For Negative Binomial, returns the \code{size}
(theta) instead. For Gamma, it attempts ML shape via \pkg{MASS}’s
\code{\link[MASS]{gamma.shape}}; if unavailable or it fails, it falls back
to the Pearson estimator.
}
\details{
\itemize{
\item \strong{Gaussian}: returns \code{phi = sigma^2} (Pearson).
\item \strong{Poisson/Binomial}: returns \code{phi = 1}.
\item \strong{Gamma}: tries ML shape via \code{MASS::gamma.shape} if possible;
otherwise Pearson. Final \code{phi = 1/shape}.
\item \strong{Inverse-Gaussian}: Pearson; \code{lambda = 1/phi}.
\item \strong{Negative Binomial}: returns \code{disp = 1} and
\code{extra$size = theta}.
}
}
\examples{
set.seed(1)
n <- 200; X <- cbind(1, rnorm(n)); beta <- c(0, 0.5)
eta <- as.vector(X \%*\% beta); mu <- exp(eta)
y <- rgamma(n, shape = 2, scale = mu/2)
out <- extract_margin_dispersion(y, X, eta, family = Gamma("log"))
str(out)  # disp ≈ 1/shape

}
\seealso{
\code{\link{estimate_dispersion_pearson}}, \code{\link[MASS]{gamma.shape}}
}
